<nav class="navbar">
    <div class="navbar-container">
        <!-- Logo -->
        {% if current_user.is_authenticated and current_user.role != 'ADMIN' %}
            <a href="/shop" class="navbar-brand">
                <img src="{{ url_for('static', filename='img/logo-nuur.png') }}" alt="Nuur Logo" class="navbar-logo" />
                <span>Nuur-Library</span>
            </a>
        {% elif current_user.is_authenticated %}
            <a href="/admin/bookstore" class="navbar-brand">
                <img src="{{ url_for('static', filename='img/logo-nuur.png') }}" alt="Nuur Logo" class="navbar-logo" />
                <span>Nuur-Library</span>
            </a>
        {% else %}
            <a href="/login" class="navbar-brand">
                <img src="{{ url_for('static', filename='img/logo-nuur.png') }}" alt="Nuur Logo" class="navbar-logo" />
                <span>Nuur-Library</span>
            </a>
        {% endif %}

        <!-- Search Section -->
        <div class="navbar-search-container">
            {% include "shared/search_livre.html" %}
        </div>

        <!-- User Menu -->
        <div class="navbar-user-menu">
            {% if current_user.is_authenticated %}
                <!-- Navigation Links - Menu Desktop -->
                <ul class="navbar-menu desktop-menu">
                    {% if current_user.role != 'ADMIN' %}
                        <li class="navbar-item">
                            <a href="/shop" class="navbar-link">
                                <i class="fas fa-store"></i>
                                Boutique
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="/bibliotheque" class="navbar-link">
                                <i class="fas fa-book"></i>
                                Bibliothèque
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="{{ url_for('panier', user_id=current_user.id) }}" class="navbar-link">
                                <i class="fas fa-shopping-cart"></i>
                                Panier
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="{{ url_for('commandes', user_id=current_user.id) }}" class="navbar-link">
                                <i class="fas fa-receipt"></i>
                                Commandes
                            </a>
                        </li>
                    {% else %}
                        <li class="navbar-item">
                            <a href="/admin/bookstore" class="navbar-link">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="/admin/clients" class="navbar-link">
                                <i class="fas fa-users"></i>
                                Clients
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="/admin/commandes" class="navbar-link">
                                <i class="fas fa-clipboard-list"></i>
                                Commandes
                            </a>
                        </li>
                        <li class="navbar-item">
                            <a href="/admin/form-livre" class="navbar-link">
                                <i class="fas fa-plus"></i>
                                Ajouter Livre
                            </a>
                        </li>
                    {% endif %}
                </ul>

                <!-- User Dropdown -->
                <div class="dropdown">
                    <button class="navbar-link flex items-center gap-2">
                        <img src="{{ url_for('static', filename='img/user.png') }}" alt="User" class="w-8 h-8 rounded-full">
                        <span class="hidden md:block">{{ current_user.username }}</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    
                    <div class="dropdown-menu">
                        <div class="p-4 border-b border-gray-200">
                            <p class="font-semibold text-gray-800">{{ current_user.username }}</p>
                            <p class="text-sm text-gray-500">{{ current_user.role }}</p>
                        </div>
                        
                        {% if current_user.role != 'ADMIN' %}
                            <a href="/shop" class="dropdown-item">
                                <i class="fas fa-store text-primary"></i>
                                Boutique
                            </a>
                            <a href="/bibliotheque" class="dropdown-item">
                                <i class="fas fa-book text-primary"></i>
                                Bibliothèque
                            </a>
                            <a href="{{ url_for('panier', user_id=current_user.id) }}" class="dropdown-item">
                                <i class="fas fa-shopping-cart text-primary"></i>
                                Panier
                            </a>
                            <a href="{{ url_for('commandes', user_id=current_user.id) }}" class="dropdown-item">
                                <i class="fas fa-receipt text-primary"></i>
                                Commandes
                            </a>
                        {% else %}
                            <a href="/admin/bookstore" class="dropdown-item">
                                <i class="fas fa-tachometer-alt text-primary"></i>
                                Dashboard
                            </a>
                            <a href="/admin/clients" class="dropdown-item">
                                <i class="fas fa-users text-primary"></i>
                                Clients
                            </a>
                            <a href="/admin/commandes" class="dropdown-item">
                                <i class="fas fa-clipboard-list text-primary"></i>
                                Commandes
                            </a>
                            <a href="/admin/form-livre" class="dropdown-item">
                                <i class="fas fa-plus text-primary"></i>
                                Ajouter Livre
                            </a>
                        {% endif %}
                        
                        <div class="border-t border-gray-200 mt-2 pt-2">
                            <a href="/logout" class="dropdown-item text-error">
                                <i class="fas fa-sign-out-alt"></i>
                                Déconnexion
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            {% else %}
                <!-- Login Button -->
                <a href="/login" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    Se connecter
                </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Mobile Menu -->
    {% if current_user.is_authenticated %}
    <ul class="navbar-menu mobile-menu" id="mobile-menu">
        {% if current_user.role != 'ADMIN' %}
            <li class="navbar-item">
                <a href="/shop" class="navbar-link">
                    <i class="fas fa-store"></i>
                    Boutique
                </a>
            </li>
            <li class="navbar-item">
                <a href="/bibliotheque" class="navbar-link">
                    <i class="fas fa-book"></i>
                    Bibliothèque
                </a>
            </li>
            <li class="navbar-item">
                <a href="{{ url_for('panier', user_id=current_user.id) }}" class="navbar-link">
                    <i class="fas fa-shopping-cart"></i>
                    Panier
                </a>
            </li>
            <li class="navbar-item">
                <a href="{{ url_for('commandes', user_id=current_user.id) }}" class="navbar-link">
                    <i class="fas fa-receipt"></i>
                    Commandes
                </a>
            </li>
        {% else %}
            <li class="navbar-item">
                <a href="/admin/bookstore" class="navbar-link">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
            </li>
            <li class="navbar-item">
                <a href="/admin/clients" class="navbar-link">
                    <i class="fas fa-users"></i>
                    Clients
                </a>
            </li>
            <li class="navbar-item">
                <a href="/admin/commandes" class="navbar-link">
                    <i class="fas fa-clipboard-list"></i>
                    Commandes
                </a>
            </li>
            <li class="navbar-item">
                <a href="/admin/form-livre" class="navbar-link">
                    <i class="fas fa-plus"></i>
                    Ajouter Livre
                </a>
            </li>
        {% endif %}
        <li class="navbar-item">
            <a href="/logout" class="navbar-link text-error">
                <i class="fas fa-sign-out-alt"></i>
                Déconnexion
            </a>
        </li>
    </ul>
    {% endif %}
</nav>

<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (menu) {
        menu.classList.toggle('active');
        
        // Animation de l'icône du bouton
        const icon = menuToggle.querySelector('i');
        if (menu.classList.contains('active')) {
            icon.className = 'fas fa-times';
        } else {
            icon.className = 'fas fa-bars';
        }
    }
}

// Fermer le menu mobile quand on clique en dehors
document.addEventListener('click', function(event) {
    const menu = document.getElementById('mobile-menu');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (menu && menu.classList.contains('active')) {
        if (!menu.contains(event.target) && !menuToggle.contains(event.target)) {
            menu.classList.remove('active');
            const icon = menuToggle.querySelector('i');
            icon.className = 'fas fa-bars';
        }
    }
});

// Fermer le menu mobile lors du redimensionnement vers desktop
window.addEventListener('resize', function() {
    const menu = document.getElementById('mobile-menu');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (window.innerWidth > 768 && menu && menu.classList.contains('active')) {
        menu.classList.remove('active');
        if (menuToggle) {
            const icon = menuToggle.querySelector('i');
            icon.className = 'fas fa-bars';
        }
    }
});
</script>