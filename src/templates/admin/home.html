{% extends "layouts/base.html" %} {% block title %} {{ super() }} | Tableau de
Bord Admin {% endblock title %} {% block content %}
<!-- Dashboard Admin -->
<div class="container mx-auto px-6 py-8 admin-dashboard">
  <!-- En-tête -->
  <div class="mb-12" style="margin-top: 3rem">
    <h1 class="text-4xl font-bold text-primary font-heading mb-4">
      <i class="fas fa-tachometer-alt text-secondary mr-3"></i>
      Tableau de Bord Administrateur
    </h1>
    <p class="text-gray-600 mb-8">
      Bienvenue {{ current_user.prenom }}, voici un aperçu de votre librairie
    </p>
  </div>

  <!-- Actions Rapides -->
  <div class="grid grid-cols-3 gap-8 mb-16">
    <a href="{{ url_for('ajout_livre') }}" class="action-card group">
      <div class="action-icon bg-primary">
        <i class="fas fa-plus text-white text-xl"></i>
      </div>
      <h3 class="action-title">Ajouter un Livre</h3>
      <p class="action-subtitle mb-4">Enrichir votre catalogue</p>
      <div class="action-arrow">
        <i
          class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"
        ></i>
      </div>
    </a>

    <a href="{{ url_for('clients') }}" class="action-card group">
      <div class="action-icon bg-secondary mb-4">
        <i class="fas fa-users text-white text-xl"></i>
      </div>
      <h3 class="action-title">Gérer les Clients</h3>
      <p class="action-subtitle mb-4">Consulter et modifier</p>
      <div class="action-arrow">
        <i
          class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"
        ></i>
      </div>
    </a>

    <a href="{{ url_for('commandes_ad') }}" class="action-card group">
      <div class="action-icon bg-accent mb-4">
        <i class="fas fa-box text-white text-xl"></i>
      </div>
      <h3 class="action-title">Voir les Commandes</h3>
      <p class="action-subtitle mb-4">Traiter les demandes</p>
      <div class="action-arrow">
        <i
          class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"
        ></i>
      </div>
    </a>
  </div>

  <!-- Filtres et Recherche -->
  <div class="bg-white rounded-2xl shadow-lg p-6 mb-8" style="margin-top: 3rem">
    <div class="flex flex-wrap items-center gap-4">
      <!-- Recherche par titre -->
      <div class="flex-1 min-w-64">
        <div class="relative">
          <input
            type="text"
            id="search-books"
            placeholder="Rechercher par titre, auteur..."
            class="form-input pl-10"
            onkeyup="filterBooks()"
          />
        </div>
      </div>

      <!-- Filtre par disponibilité -->
      <select
        id="filter-availability"
        class="form-select"
        onchange="filterBooks()"
      >
        <option value="">Toutes les disponibilités</option>
        <option value="disponible">Disponible</option>
        <option value="indisponible">Indisponible</option>
      </select>

      <!-- Filtre par stock -->
      <select id="filter-stock" class="form-select" onchange="filterBooks()">
        <option value="">Tout le stock</option>
        <option value="low">Stock faible (< 5)</option>
        <option value="medium">Stock moyen (5-20)</option>
        <option value="high">Stock élevé (> 20)</option>
      </select>

      <!-- Tri -->
      <select id="sort-books" class="form-select" onchange="sortBooks()">
        <option value="">Trier par...</option>
        <option value="title-asc">Titre (A-Z)</option>
        <option value="title-desc">Titre (Z-A)</option>
        <option value="price-asc">Prix croissant</option>
        <option value="price-desc">Prix décroissant</option>
        <option value="stock-asc">Stock croissant</option>
        <option value="stock-desc">Stock décroissant</option>
      </select>

      <!-- Bouton reset -->
      <button onclick="resetFilters()" class="btn btn-ghost">
        <i class="fas fa-refresh mr-2"></i>
        Reset
      </button>
    </div>
  </div>

  <!-- Section Livres Récents -->
  <div class="bg-white rounded-2xl shadow-lg p-8" style="margin-top: 3rem">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl font-bold text-gray-800">
        <i class="fas fa-clock text-primary mr-2"></i>
        Livres Récents
      </h2>
      <a href="{{ url_for('ajout_livre') }}" class="btn btn-primary">
        <i class="fas fa-plus mr-2"></i>
        Ajouter
      </a>
    </div>

    {% if livres %}
    <div
      class="grid gap-6"
      style="
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 1.5rem;
      "
      id="books-grid"
    >
      {% for livre in livres %}
      <div
        class="book-card-admin"
        data-title="{{ livre.title.lower() }}"
        data-author="{{ livre.auteur.lower() }}"
        data-price="{{ livre.prix }}"
        data-stock="{{ livre.stock }}"
        data-available="{{ 'true' if livre.stock > 0  else 'false' }}"
      >
        <div class="book-image-wrapper">
          <img
            src="{{ livre.img_url or url_for('static', filename='img/biblio1.jpeg') }}"
            alt="{{ livre.title }}"
            class="book-image-admin"
          />

          {% if livre.disponible %}
          <span class="book-status book-status-available">
            <i class="fas fa-check"></i>
          </span>
          {% else %}
          <span class="book-status book-status-unavailable">
            <i class="fas fa-times"></i>
          </span>
          {% endif %}
        </div>

        <div class="book-info-admin">
          <h3 class="book-title-admin">{{ livre.title }}</h3>
          <p class="book-author-admin">{{ livre.auteur }}</p>
          <p class="book-price-admin">{{ "%.2f"|format(livre.prix) }} FCFA</p>
          <p class="book-stock-admin">Stock: {{ livre.stock }}</p>

          <div class="book-actions-admin">
            <a
              href="{{ url_for('detail_livre_c', id_livre=livre.id) }}"
              class="btn-admin btn-admin-view"
              title="Voir les détails de {{ livre.title }}"
              aria-label="Voir les détails de {{ livre.title }}"
            >
              <i class="fas fa-eye"></i>
            </a>
            <a
              href="#"
              class="btn-admin btn-admin-edit"
              title="Modifier {{ livre.title }}"
              aria-label="Modifier {{ livre.title }}"
            >
              <i class="fas fa-edit"></i>
            </a>
            <a
              href="#"
              class="btn-admin btn-admin-delete"
              title="Supprimer {{ livre.title }}"
              aria-label="Supprimer {{ livre.title }}"
            >
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12">
      <i class="fas fa-book text-gray-300 text-6xl mb-4"></i>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        Aucun livre dans la collection
      </h3>
      <p class="text-gray-500 mb-6">
        Commencez par ajouter votre premier livre
      </p>
      <a href="{{ url_for('ajout_livre') }}" class="btn btn-primary">
        <i class="fas fa-plus mr-2"></i>
        Ajouter un Livre
      </a>
    </div>
    {% endif %}
  </div>
</div>

<script>
  // Fonctions de filtrage pour les livres admin
  function filterBooks() {
    const searchValue = document
      .getElementById("search-books")
      .value.toLowerCase();
    const availabilityFilter = document.getElementById(
      "filter-availability"
    ).value;
    const stockFilter = document.getElementById("filter-stock").value;

    const bookCards = document.querySelectorAll(".book-card-admin");

    bookCards.forEach((card) => {
      let showCard = true;

      // Filtre par recherche (titre et auteur)
      if (searchValue) {
        const title = card.getAttribute("data-title");
        const author = card.getAttribute("data-author");
        if (!title.includes(searchValue) && !author.includes(searchValue)) {
          showCard = false;
        }
      }

      // Filtre par disponibilité
      if (availabilityFilter && showCard) {
        const available = card.getAttribute("data-available");
        if (availabilityFilter === "disponible" && available !== "true") {
          showCard = false;
        } else if (
          availabilityFilter === "indisponible" &&
          available !== "false"
        ) {
          showCard = false;
        }
      }

      // Filtre par stock
      if (stockFilter && showCard) {
        const stock = parseInt(card.getAttribute("data-stock"));
        if (stockFilter === "low" && stock >= 5) {
          showCard = false;
        } else if (stockFilter === "medium" && (stock < 5 || stock > 20)) {
          showCard = false;
        } else if (stockFilter === "high" && stock <= 20) {
          showCard = false;
        }
      }

      // Afficher ou cacher la carte
      card.style.display = showCard ? "block" : "none";
    });

    updateResultsCount();
  }

  function sortBooks() {
    const sortValue = document.getElementById("sort-books").value;
    const grid = document.getElementById("books-grid");
    const cards = Array.from(document.querySelectorAll(".book-card-admin"));

    if (!sortValue) return;

    cards.sort((a, b) => {
      switch (sortValue) {
        case "title-asc":
          return a
            .getAttribute("data-title")
            .localeCompare(b.getAttribute("data-title"));
        case "title-desc":
          return b
            .getAttribute("data-title")
            .localeCompare(a.getAttribute("data-title"));
        case "price-asc":
          return (
            parseFloat(a.getAttribute("data-price")) -
            parseFloat(b.getAttribute("data-price"))
          );
        case "price-desc":
          return (
            parseFloat(b.getAttribute("data-price")) -
            parseFloat(a.getAttribute("data-price"))
          );
        case "stock-asc":
          return (
            parseInt(a.getAttribute("data-stock")) -
            parseInt(b.getAttribute("data-stock"))
          );
        case "stock-desc":
          return (
            parseInt(b.getAttribute("data-stock")) -
            parseInt(a.getAttribute("data-stock"))
          );
        default:
          return 0;
      }
    });

    // Réorganiser les cartes dans le DOM
    cards.forEach((card) => grid.appendChild(card));
  }

  function resetFilters() {
    document.getElementById("search-books").value = "";
    document.getElementById("filter-availability").value = "";
    document.getElementById("filter-stock").value = "";
    document.getElementById("sort-books").value = "";

    // Réafficher toutes les cartes
    document.querySelectorAll(".book-card-admin").forEach((card) => {
      card.style.display = "block";
    });

    updateResultsCount();
  }

  function updateResultsCount() {
    const visibleCards = document.querySelectorAll(
      '.book-card-admin[style*="block"], .book-card-admin:not([style*="none"])'
    ).length;
    const totalCards = document.querySelectorAll(".book-card-admin").length;

    // Vous pouvez ajouter ici un élément pour afficher le nombre de résultats
    console.log(`${visibleCards} livres affichés sur ${totalCards}`);
  }

  // Initialiser les filtres au chargement de la page
  document.addEventListener("DOMContentLoaded", function () {
    updateResultsCount();
  });
</script>

{% endblock %}
